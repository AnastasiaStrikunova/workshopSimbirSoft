databaseChangeLog:
  - changeSet:
      id: 000000-create-sequences
      author: Strikunova Anastasia
      changes:
        - createSequence:
            cycle: false
            sequenceName: seq_project
            startValue: 1
            incrementBy: 1
            dataType: bigint
            maxValue: 9223372036854775807
            minValue: 1
        - createSequence:
            cycle: false
            sequenceName: seq_release
            startValue: 1
            dataType: bigint
        - createSequence:
            cycle: false
            sequenceName: seq_status
            startValue: 1
            dataType: bigint
        - createSequence:
            cycle: false
            sequenceName: seq_task
            startValue: 1
            dataType: bigint
        - createSequence:
            cycle: false
            sequenceName: seq_user
            startValue: 1
            dataType: bigint

  - changeSet:
      id: 000000-create-tables
      author: Strikunova Anastasia
      changes:
        - createTable:
            tableName: project
            columns:
              - column: { name: id_project, type: BIGINT }
              - column: { name: title, type: VARCHAR(30) }
              - column: { name: is_complete, type: BOOLEAN }
              - column: { name: id_status, type: BIGINT }
              - column: { name: id_user, type: BIGINT }
        - createTable:
            tableName: release
            columns:
              - column: { name: id_release, type: BIGINT }
              - column: { name: version, type: VARCHAR(30) }
              - column: { name: start_time, type: TIMESTAMP WITH TIME ZONE, defaultValueComputed: now() }
              - column: { name: end_time, type: TIMESTAMP WITH TIME ZONE, defaultValueComputed: now() }
        - createTable:
            tableName: status
            columns:
              - column: { name: id_status, type: BIGINT }
              - column: { name: title, type: VARCHAR(30) }
        - createTable:
            tableName: task
            columns:
              - column: { name: id_task, type: BIGINT }
              - column: { name: title, type: VARCHAR(30) }
              - column: { name: priority, type: VARCHAR(30) }
              - column: { name: author, type: BIGINT }
              - column: { name: performer, type: BIGINT }
              - column: { name: start_time, type: TIMESTAMP WITH TIME ZONE, defaultValueComputed: now() }
              - column: { name: end_time, type: TIMESTAMP WITH TIME ZONE, defaultValueComputed: now() }
              - column: { name: id_project, type: BIGINT }
              - column: { name: id_status, type: BIGINT }
              - column: { name: id_release, type: BIGINT }
        - createTable:
            tableName: userr
            columns:
              - column: { name: id_user, type: BIGINT }
              - column: { name: name, type: VARCHAR(30) }
              - column: { name: priority, type: VARCHAR(30) }

  - changeSet:
      id: 000000-add-keys
      author: Strikunova Anastasia
      changes:
        - addPrimaryKey: { columnNames: id_project, constraintName: pk_project, tableName: project }
        - addPrimaryKey: { columnNames: id_release, constraintName: pk_release, tableName: release }
        - addPrimaryKey: { columnNames: id_status, constraintName: pk_status, tableName: status }
        - addPrimaryKey: { columnNames: id_task, constraintName: pk_task, tableName: task }
        - addPrimaryKey: { columnNames: id_user, constraintName: pk_user, tableName: userr }
        - addForeignKeyConstraint:
            baseColumnNames: id_status
            baseTableName: project
            constraintName: fk_project_0
            deferrable: true
            initiallyDeferred: true
            onDelete: CASCADE
            onUpdate: RESTRICT
            referencedColumnNames: id_status
            referencedTableName: status
            referencedTableSchemaName: public
        - addForeignKeyConstraint:
            baseColumnNames: id_user
            baseTableName: project
            constraintName: fk_project_1
            deferrable: true
            initiallyDeferred: true
            onDelete: CASCADE
            onUpdate: RESTRICT
            referencedColumnNames: id_user
            referencedTableName: userr
            referencedTableSchemaName: public
        - addForeignKeyConstraint:
            baseColumnNames: author
            baseTableName: task
            constraintName: fk_task_0
            deferrable: true
            initiallyDeferred: true
            onDelete: CASCADE
            onUpdate: RESTRICT
            referencedColumnNames: id_user
            referencedTableName: userr
            referencedTableSchemaName: public
        - addForeignKeyConstraint:
            baseColumnNames: performer
            baseTableName: task
            constraintName: fk_task_1
            deferrable: true
            initiallyDeferred: true
            onDelete: CASCADE
            onUpdate: RESTRICT
            referencedColumnNames: id_user
            referencedTableName: userr
            referencedTableSchemaName: public
        - addForeignKeyConstraint:
            baseColumnNames: id_project
            baseTableName: task
            constraintName: fk_task_2
            deferrable: true
            initiallyDeferred: true
            onDelete: CASCADE
            onUpdate: RESTRICT
            referencedColumnNames: id_project
            referencedTableName: project
            referencedTableSchemaName: public
        - addForeignKeyConstraint:
            baseColumnNames: id_status
            baseTableName: task
            constraintName: fk_task_3
            deferrable: true
            initiallyDeferred: true
            onDelete: CASCADE
            onUpdate: RESTRICT
            referencedColumnNames: id_status
            referencedTableName: status
            referencedTableSchemaName: public
        - addForeignKeyConstraint:
            baseColumnNames: id_release
            baseTableName: task
            constraintName: fk_task_4
            deferrable: true
            initiallyDeferred: true
            onDelete: CASCADE
            onUpdate: RESTRICT
            referencedColumnNames: id_release
            referencedTableName: release
            referencedTableSchemaName: public

  - changeSet:
      id: 000000-add-comments
      author: Strikunova Anastasia
      changes:
        - sql:
            dbms: postgresql
            stripComments: true
            sql: comment on table project is 'Таблица хранения проектов';
        - sql:
            dbms: postgresql
            stripComments: true
            sql: comment on table release is 'Таблица хранения релизов';
        - sql:
            dbms: postgresql
            stripComments: true
            sql: comment on table status is 'Таблица хранения статусов';
        - sql:
            dbms: postgresql
            stripComments: true
            sql: comment on table task is 'Таблица хранения задач';
        - sql:
            dbms: postgresql
            stripComments: true
            sql: comment on table userr is 'Таблица хранения пользователей';
